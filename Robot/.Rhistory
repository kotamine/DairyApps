robot_cycle <- 2
loan2 <- 350000
debt_tbl1 <- debt_table(loan, interest_rate, loan_period,
robot_year, robot_cycle, 50,
loan2=loan2)
loan_housing <- 1040000
loan_period_housing <- 24
housing_year <- 30
debt_tbl2 <- debt_table(loan_housing, interest_rate, loan_period_housing,
housing_year, 1, 50)
debt_table2(loan, interest_rate, loan_period,
robot_year, 50, 1)
debt_table2 <- function(loan, interest_rate, loan_period,
asset_period, n_period, starting_year) {
pmt <- -pmt(interest_rate, loan_period, loan)
interest <- impt(interest_rate, 1, loan_period, loan)
principal <- pmt - interest
df <- data.frame(yr=c(1:n_period), yr_asset =rep(0,n_period))
ending_year <- asset_period + starting_year - 1
df$yr_asset[starting_year:ending_year] <- c(1:asset_period)
df$interest_asset <- (df$yr_asset >0) *
(-1) * impt(interest_rate, df$yr_asset, loan_period, loan)
df$principal_asset <- (df$yr_asset >0) * (pmt - df$interest_asset)
return(df)
}
debt_table2(loan, interest_rate, loan_period,
robot_year, 50, 1)
debt_table2 <- function(loan, interest_rate, loan_period,
asset_period, n_period, starting_year) {
pmt <- -pmt(interest_rate, loan_period, loan)
interest <- impt(interest_rate, 1, loan_period, loan)
principal <- pmt - interest
df <- data.frame(yr=c(1:n_period), yr_asset =rep(0,n_period))
ending_year <- loan_period + starting_year - 1
df$yr_pmt[starting_year:ending_year] <- c(1:loan_period)
df$interest_asset <-  (df$yr_pmt >0) *
(-1) * impt(interest_rate, df$yr_asset, loan_period, loan)
df$principal_asset <- (df$yr_pmt >0) * (pmt - df$interest_asset)
return(df)
}
debt_table2(loan, interest_rate, loan_period,
robot_year, 50, 1)
debt_table2 <- function(loan, interest_rate, loan_period,
asset_period, n_period, starting_year) {
pmt <- -pmt(interest_rate, loan_period, loan)
interest <- impt(interest_rate, 1, loan_period, loan)
principal <- pmt - interest
df <- data.frame(yr=c(1:n_period), yr_pmt =rep(0,n_period))
ending_year <- loan_period + starting_year - 1
df$yr_pmt[starting_year:ending_year] <- c(1:loan_period)
df$interest_asset <-  (df$yr_pmt >0) *
(-1) * impt(interest_rate, df$yr_asset, loan_period, loan)
df$principal_asset <- (df$yr_pmt >0) * (pmt - df$interest_asset)
return(df)
}
debt_table2(loan, interest_rate, loan_period,
robot_year, 50, 1)
debt_table2 <- function(loan, interest_rate, loan_period,
asset_period, n_period, starting_year) {
pmt <- -pmt(interest_rate, loan_period, loan)
interest <- impt(interest_rate, 1, loan_period, loan)
principal <- pmt - interest
df <- data.frame(yr=c(1:n_period), yr_pmt =rep(0,n_period))
ending_year <- loan_period + starting_year - 1
df$yr_pmt[starting_year:ending_year] <- c(1:loan_period)
df$interest_asset <-  (df$yr_pmt >0) *
(-1) * impt(interest_rate, df$yr_pmt, loan_period, loan)
df$principal_asset <- (df$yr_pmt >0) * (pmt - df$interest_asset)
return(df)
}
debt_table2(loan, interest_rate, loan_period,
robot_year, 50, 1)
debt_table2 <- function(loan, interest_rate, loan_period,
n_period, starting_year) {
pmt <- -pmt(interest_rate, loan_period, loan)
interest <- impt(interest_rate, 1, loan_period, loan)
principal <- pmt - interest
df <- data.frame(yr=c(1:n_period), yr_pmt =rep(0,n_period))
ending_year <- loan_period + starting_year - 1
df$yr_pmt[starting_year:ending_year] <- c(1:loan_period)
df$interest_asset <-  (df$yr_pmt >0) *
(-1) * impt(interest_rate, df$yr_pmt, loan_period, loan)
df$principal_asset <- (df$yr_pmt >0) * (pmt - df$interest_asset)
return(df)
}
debt_table2(loan, interest_rate, loan_period, 50, 1)
debt_table2(loan, interest_rate, loan_period, 50, robot_year+1)
debt_table2(loan2, interest_rate, loan_period, 50, robot_year+1)
debt_table(loan_housing, interest_rate, loan_period_housing, 50, 1)
loan_housing <- 1040000
loan_period_housing <- 24
housing_year <- 30
debt_tbl2 <- debt_table(loan_housing, interest_rate, loan_period_housing,
housing_year, 1, 50)
debt_table2(loan2, interest_rate, loan_period, 50, robot_year+1)
debt_table2(loan_housing, interest_rate, loan_period_housing, 50, 1)
c(1:round(3.14))
p
t
e
o
o[1] <- 1
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, swith=TRUE, sequence=FALSE) {
v <- c(); vsum <- c(); s <- (cost-salvage)/nper
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) *s
vsum <- v[1]
for (t in 2:nper) {
tmp <- (cost - vsum[t-1]) * factor/nper
v[t] <- (tmp>s) * tmp + (tmp<=s) *s
vsum[t] <- vsum[t-1] + v[t]
}
if (sequence) return(sum(v[start_per:end_per]))
else return(v)
}
vdb(10000,1000,10,1,1)
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, swith=TRUE, sequence=FALSE) {
v <- c(); vsum <- c(); s <- (cost-salvage)/nper
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) *s
vsum <- v[1]
for (t in 2:nper) {
val <- cost - vsum[t-1]
s <-  val/(nper - t + 1)
tmp <- val * factor/nper
v[t] <- (tmp>s) * tmp + (tmp<=s) *s
vsum[t] <- vsum[t-1] + v[t]
}
if (!sequence)  {
return(sum(v[start_per:end_per]))
} else {
return(v)
}
}
vdb(10000,1000,10,1,1)
vdb(10000,1000,10,sequence=TRUE)
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, swith=TRUE, sequence=FALSE) {
v <- c(); vsum <- c();
s0 <- (cost-salvage)/nper;  s <- s0
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) *s
vsum <- v[1]
for (t in 2:nper) {
s <-  (cost - vsum[t-1] - s0)/(nper - t + 1)
tmp <-  (cost - vsum[t-1]) * factor/nper
v[t] <- (tmp>s) * tmp + (tmp<=s) *s
vsum[t] <- vsum[t-1] + v[t]
}
if (!sequence)  {
return(sum(v[start_per:end_per]))
} else {
return(v)
}
}
vdb(10000,1000,10,sequence=TRUE)
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, swith=TRUE, sequence=FALSE) {
v <- c(); vsum <- c();
s0 <- (cost-salvage)/nper;  s <- s0
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) * s
vsum <- v[1]
for (t in 2:nper) {
print(cost - vsum[t-1])
s <-  (cost - vsum[t-1] - s0)/(nper - t + 1)
tmp <-  (cost - vsum[t-1]) * factor/nper
v[t] <- (tmp>s) * tmp + (tmp<=s) * s
vsum[t] <- vsum[t-1] + v[t]
}
if (!sequence)  {
return(sum(v[start_per:end_per]))
} else {
return(v)
}
}
vdb(10000,1000,10,sequence=TRUE)
677/2
677 * 2/10
677 * 2/10
1677 * 2/10
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, swith=TRUE, sequence=FALSE) {
v <- c(); vsum <- c();
s0 <- (cost-salvage)/nper;  s <- s0
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) * s
vsum <- v[1]
for (t in 2:nper) {
print(cost - vsum[t-1])
s <-  (cost - vsum[t-1] - salvage)/(nper - t + 1)
tmp <-  (cost - vsum[t-1]) * factor/nper
v[t] <- (tmp>s) * tmp + (tmp<=s) * s
vsum[t] <- vsum[t-1] + v[t]
}
if (!sequence)  {
return(sum(v[start_per:end_per]))
} else {
return(v)
}
}
vdb(10000,1000,10,sequence=TRUE)
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, swith=TRUE, sequence=FALSE) {
v <- c(); vsum <- c();
s0 <- (cost-salvage)/nper;  s <- s0
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) * s
vsum <- v[1]
for (t in 2:nper) {
s <-  (cost - vsum[t-1] - salvage)/(nper - t + 1)
tmp <-  (cost - vsum[t-1]) * factor/nper
v[t] <- (tmp>s) * tmp + (tmp<=s) * s
vsum[t] <- vsum[t-1] + v[t]
}
if (!sequence)  {
return(sum(v[start_per:end_per]))
} else {
return(v)
}
}
vdb(10000,1000,10,sequence=TRUE)
vdb(360000,4500,7,factor=1.5,sequence=TRUE)
vdb(360000,4500,7,factor=1.5,switch=FALSE,sequence=TRUE)
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, switch=TRUE, sequence=FALSE) {
v <- c(); vsum <- c();
s0 <- (cost-salvage)/nper;  s <- s0
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) * s
vsum <- v[1]
for (t in 2:nper) {
s <-  (cost - vsum[t-1] - salvage)/(nper - t + 1)
tmp <-  (cost - vsum[t-1]) * factor/nper
v[t] <- (tmp>s) * tmp + (tmp<=s) * s
vsum[t] <- vsum[t-1] + v[t]
}
if (!sequence)  {
return(sum(v[start_per:end_per]))
} else {
return(v)
}
}
vdb(10000,1000,10,sequence=TRUE)
vdb(360000,4500,7,factor=1.5,switch=FALSE,sequence=TRUE)
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, switch=TRUE, sequence=FALSE) {
v <- c(); vsum <- c();
s0 <- (cost-salvage)/nper;  s <- s0
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) * s
vsum <- v[1]
for (t in 2:nper) {
s <-  (cost - vsum[t-1] - salvage)/(nper - t + 1)
tmp <-  (cost - vsum[t-1]) * factor/nper
v[t] <- switch * ((tmp>s) * tmp + (tmp<=s) * s ) + (!switch) * tmp
vsum[t] <- vsum[t-1] + v[t]
}
if (!sequence)  {
return(sum(v[start_per:end_per]))
} else {
return(v)
}
}
vdb(10000,1000,10,sequence=TRUE)
vdb(360000,4500,7,factor=1.5,switch=FALSE,sequence=TRUE)
vdb(360000,4500,7,factor=1.5,sequence=TRUE)
vdb(360000,4500,7,factor=2,sequence=TRUE)
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, switch=TRUE, sequence=FALSE) {
v <- c(); vsum <- c();
s0 <- (cost-salvage)/nper;  s <- s0
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) * s
vsum <- v[1]
for (t in 2:nper) {
s <-  (cost - vsum[t-1] - salvage) * factor/(nper - t + 1)
tmp <-  (cost - vsum[t-1]) * factor/nper
v[t] <- switch * ((tmp>s) * tmp + (tmp<=s) * s ) + (!switch) * tmp
vsum[t] <- vsum[t-1] + v[t]
}
if (!sequence)  {
return(sum(v[start_per:end_per]))
} else {
return(v)
}
}
vdb(10000,1000,10,sequence=TRUE)
vdb(360000,4500,7,factor=1.5,sequence=TRUE)
vdb <- function(cost, salvage, nper, start_per=1, end_per=1, factor=2, switch=TRUE, sequence=FALSE) {
v <- c(); vsum <- c();
s0 <- (cost-salvage)/nper;  s <- s0
tmp <- cost * factor/nper
v[1] <- (tmp>s) * tmp + (tmp<=s) * s
vsum <- v[1]
for (t in 2:nper) {
s <-  (cost - vsum[t-1] - salvage)/(nper - t + 1)
tmp <-  (cost - vsum[t-1]) * factor/nper
v[t] <- switch * ((tmp>s) * tmp + (tmp<=s) * s ) + (!switch) * tmp
vsum[t] <- vsum[t-1] + v[t]
}
if (!sequence)  {
return(sum(v[start_per:end_per]))
} else {
return(v)
}
}
vdb(10000,1000,10,sequence=TRUE)
vdb(360000,4500,7,factor=1.5,sequence=TRUE)
vdb(360000,4500,7,factor=2,sequence=TRUE)
vdb(360000,4500,7,factor=1.5,sequence=TRUE)
vdb(360000,4500,7,factor=1.5,sequence=TRUE) %>% sum()
360000-4500
vdb(360000,45000,7,factor=1.5,sequence=TRUE) %>% sum()
vdb(360000,45000,7,factor=1.5,sequence=TRUE)
n_years <- 50;
table_cash_flow <- matrix(rep(c(1:n_years),10),ncol=10,byrow=TRUE)  %>% data.frame()
colnames(table_cash_flow) <- c("year","downpayment","interest_total","depreciation","operating_income",
"income_tax", "principal_total","add_back_depr","after_tax_cash_flow")
table_cash_flow
n_years <- 50;
table_cash_flow <- matrix(c(c(1:n_years), rep(rep(0,n_years),9)),ncol=10,byrow=FALSE)  %>% data.frame()
colnames(table_cash_flow) <- c("year","downpayment","interest_total","depreciation","operating_income",
"income_tax", "principal_total","add_back_depr","after_tax_cash_flow")
table_cash_flow
apply(c(1:3), function(t) {
t
}
)
apply(c(1:3), function(t) {
t
}
)
lapply(c(1:3), function(t) {
t
}
)
lapply(c(1:3), function(t) {
t
}
) %>% unlist()
(1==1) + 2
(1==0) + 2
debt_table <- function(loan, interest_rate, loan_period,
n_period, starting_year=1) {
loan_period <- round(loan_period)
n_period <- round(n_period)
starting_year <- round(starting_year)
pmt <- -pmt(interest_rate, loan_period, loan)
interest <- impt(interest_rate, 1, loan_period, loan)
principal <- pmt - interest
df <- data.frame(year=c(1:n_period), yr_pmt =rep(0,n_period))
ending_year <- loan_period + starting_year - 1
df$yr_pmt[starting_year:ending_year] <- c(1:loan_period)
df$interest_asset <-  (df$yr_pmt >0) *
(-1) * impt(interest_rate, df$yr_pmt, loan_period, loan)
df$principal_asset <- (df$yr_pmt >0) * (pmt - df$interest_asset)
return(df)
}
debt_table(loan, interest_rate, loan_period, 50, 1)
tbl1 <- debt_table(loan, interest_rate, loan_period, 50, 1)
tbl1 <- debt_table(loan, interest_rate, loan_period, 50, 1) +
+ debt_table(loan2, interest_rate, loan_period, 50, robot_year+1)
colnames(tble1) <- lapply(colnames(tble1), function(x) { paste0("robot",x)}) %>% unlist()
colnames(tbl1) <- lapply(colnames(tbl1), function(x) { paste0("robot",x)}) %>% unlist()
tbl_robot <- debt_table(loan, interest_rate, loan_period, 50, 1) +
+ debt_table(loan2, interest_rate, loan_period, 50, robot_year+1)
colnames(tbl_robot) <- lapply(colnames(tbl_robot), function(x) { paste0("robot",x)}) %>% unlist()
tbl_barn <- debt_table(loan_housing, interest_rate, loan_period_housing, 50, 1)
colnames(tbl_barn) <- lapply(colnames(tbl_barn), function(x) { paste0("barn",x)}) %>% unlist()
table_debt <- cbind(tbl_robot, tbl_barn[,c(-1)])
debt_table <- function(loan, interest_rate, loan_period,
n_period, starting_year=1) {
loan_period <- round(loan_period)
n_period <- round(n_period)
starting_year <- round(starting_year)
pmt <- -pmt(interest_rate, loan_period, loan)
interest <- impt(interest_rate, 1, loan_period, loan)
principal <- pmt - interest
df <- data.frame(year=c(1:n_period), yr_pmt =rep(0,n_period))
ending_year <- loan_period + starting_year - 1
df$yr_pmt[starting_year:ending_year] <- c(1:loan_period)
df$interest <-  (df$yr_pmt >0) *
(-1) * impt(interest_rate, df$yr_pmt, loan_period, loan)
df$principal <- (df$yr_pmt >0) * (pmt - df$interest_asset)
return(df)
}
tbl_robot <- debt_table(loan, interest_rate, loan_period, 50, 1) +
+ debt_table(loan2, interest_rate, loan_period, 50, robot_year+1)
colnames(tbl_robot) <- lapply(colnames(tbl_robot), function(x) { paste0("robot",x)}) %>% unlist()
tbl_barn <- debt_table(loan_housing, interest_rate, loan_period_housing, 50, 1)
colnames(tbl_barn) <- lapply(colnames(tbl_barn), function(x) { paste0("barn",x)}) %>% unlist()
table_debt <- cbind(tbl_robot, tbl_barn[,c(-1)])
table_debt$interest_total <- table_debt$robot_interest + table_debt$barn_interest
table_debt$principal_total <- table_debt$robot_principal + table_debt$barn_principal
table_debttable_debt$robot_interest
table_debt$robot_interest
table_debt
tbl_robot <- debt_table(loan, interest_rate, loan_period, 50, 1) +
+ debt_table(loan2, interest_rate, loan_period, 50, robot_year+1)
colnames(tbl_robot) <- lapply(colnames(tbl_robot), function(x) { paste0("robot_",x)}) %>% unlist()
tbl_barn <- debt_table(loan_housing, interest_rate, loan_period_housing, 50, 1)
colnames(tbl_barn) <- lapply(colnames(tbl_barn), function(x) { paste0("barn_",x)}) %>% unlist()
table_debt <- cbind(tbl_robot, tbl_barn[,c(-1)])
table_debt$interest_total <- table_debt$robot_interest + table_debt$barn_interest
table_debt$principal_total <- table_debt$robot_principal + table_debt$barn_principal
table_debt %>% head()
ncol=n_debt_col,byrow=FALSE)  %>% data.frame()
tbl_robot <- debt_table(loan, interest_rate, loan_period, 50, 1) +
+ debt_table(loan2, interest_rate, loan_period, 50, robot_year+1)
colnames(tbl_robot) <- lapply(colnames(tbl_robot), function(x) { paste0("robot_",x)}) %>% unlist()
tbl_barn <- debt_table(loan_housing, interest_rate, loan_period_housing, 50, 1)
colnames(tbl_barn) <- lapply(colnames(tbl_barn), function(x) { paste0("barn_",x)}) %>% unlist()
tbl_robot <- debt_table(loan, interest_rate, loan_period, 50, 1) +
+ debt_table(loan2, interest_rate, loan_period, 50, robot_year+1)
debt_table(loan, interest_rate, loan_period, 50, 1)
debt_table <- function(loan, interest_rate, loan_period,
n_period, starting_year=1) {
loan_period <- round(loan_period)
n_period <- round(n_period)
starting_year <- round(starting_year)
pmt <- -pmt(interest_rate, loan_period, loan)
interest <- impt(interest_rate, 1, loan_period, loan)
principal <- pmt - interest
df <- data.frame(year=c(1:n_period), yr_pmt =rep(0,n_period))
ending_year <- loan_period + starting_year - 1
df$yr_pmt[starting_year:ending_year] <- c(1:loan_period)
df$interest <-  (df$yr_pmt >0) *
(-1) * impt(interest_rate, df$yr_pmt, loan_period, loan)
df$principal <- (df$yr_pmt >0) * (pmt - df$interest)
return(df)
}
tbl_robot <- debt_table(loan, interest_rate, loan_period, 50, 1) +
+ debt_table(loan2, interest_rate, loan_period, 50, robot_year+1)
colnames(tbl_robot) <- lapply(colnames(tbl_robot), function(x) { paste0("robot_",x)}) %>% unlist()
tbl_barn <- debt_table(loan_housing, interest_rate, loan_period_housing, 50, 1)
colnames(tbl_barn) <- lapply(colnames(tbl_barn), function(x) { paste0("barn_",x)}) %>% unlist()
table_debt <- cbind(tbl_robot, tbl_barn[,c(-1)])
table_debt$interest_total <- table_debt$robot_interest + table_debt$barn_interest
table_debt$principal_total <- table_debt$robot_principal + table_debt$barn_principal
table_debt
vdb(cost_robot, salvage_robot, robot_year_AGDS, factor=1.5, sequence=TRUE)
cost_robot <- 360000
salvage_robot <- 45000
robot_year_AGDS <- 7
vdb(cost_robot, salvage_robot, robot_year_AGDS, factor=1.5, sequence=TRUE)
seq_along
seq_along(c(1:5))
npv(.1,c(1:5))
npv <- function(rate, values) sum(values / (1 + rate)^seq_along(values))
irr <- function(x, start=0.1) {
t <- seq_along(x)-1
f <- function(i) abs(sum(x/(1+i)^t))
return(nlm(f,start)$estimate)
}
fv <- function(rate, nper, pmt, pv = 0.0, type = 0) {
pvif <- (1+rate)^nper # Present value interest factor
fvifa <- if(rate==0) nper else ((1+rate)^nper - 1) / rate
return(-((pv * pvif) + pmt * (1.0 + rate * type) * fvifa))
}
pv <- function(rate, nper, pmt, fv = 0.0, type = 0) {
pvif <- (1+rate)^nper # Present value interest factor
fvifa <- if(rate==0) nper else ((1+rate)^nper - 1) / rate
return((-fv - pmt * (1.0 + rate * type) * fvifa) / pvif)
}
pmt <- function(rate, nper, pv, fv=0, type=0) {
rr <- 1/(1+rate)^nper
res <- (-pv-fv*rr)*rate/(1-rr)
return(res/(1+rate*type))
}
# additional functions
mirr <- function(values, finance_rate, reinvest_rate) {
n <- length(values)
tmp <- npv(reinvest_rate,values)*(1+reinvest_rate)^n/
npv(finance_rate,values)*(1+finance_rate)
return(tmp^(1/(n-1))-1)
}
# annualized net present value
# need: library(dplyr) for %>% operation
anpv <- function(x, r, i, nper) {
x_seq <- lapply(c(1:nper), function(t) { x*(1+i)^(t) }) %>% unlist()
-pmt(r, nper, npv(r, x_seq))
}
val <- c(-100000,17345,17386.24927,
17408.24629,
17409.53652,
17388.9679,
17345.33741,
17277.38899,
17184,
17063.2356,
16914.23304,
2335.312533,
2124.917986,
40240.20785,
40575.66415,
-59100.88927,
-2887.798019,
-2963.777671,
-3069.386009,
-3206.207021,
-3375.894041,
-3580.172605,
-3820.843437,
-4099.785544,
-4418.959444,
63429.89407,
46112.05519,
46794.57602,
84775.70172,
86047.33725,
129541.2133)
mirr(val, .04,.04)
mirr(val, .05,.05)
mirr(val, .03,.03)
irr(val)
shiny::runApp()
tbl_robot
tbl_barn
